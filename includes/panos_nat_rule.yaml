---
- name: "panos_nat_rule: {{ panos_nat_rule.rule_name }}"
  environment:
    PYTHONHTTPSVERIFY: 0
  panos_nat_rule:
    ip_address: "{{ provider.host }}"
    username: "{{ provider.username }}"
    password: "{{ provider.password }}"
    operation: "{{ panos_nat_rule.operation | default ('add', true) }}"
    rule_name: "{{ panos_nat_rule.rule_name }}"
    source_zone: "{{ panos_nat_rule.source_zone }}"
    destination_zone: "{{ panos_nat_rule.destination_zone }}"
    source_ip: "{{ panos_nat_rule.source_ip | default (omit) }}"
    destination_ip: "{{ panos_nat_rule.destination_ip | default (omit) }}"
    service: "{{ panos_nat_rule.service | default(omit) }}"
    snat_type: "{{ panos_nat_rule.snat_type | default (omit) }}"
    snat_interface: "{{ panos_nat_rule.snat_interface | default (omit) }}"
    dnat_address: "{{ panos_nat_rule.dnat_address | default(omit) }}"
    dnat_port: "{{ panos_nat_rule.dnat_port | default(omit) }}"
    state: "{{ panos_nat_rule.state | default('present') }}"
    commit: "false"
  register: command_result
  failed_when: "'MODULE FAILURE' in command_result.msg"
  changed_when: "'successfully added' in command_result.msg"
  notify: "save_config"
